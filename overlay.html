<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Custom Chat Overlay</title>
    <style>
        /* === SEMUA CSS KUSTOM ANDA ADA DI SINI === */
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap');

        body {
            /* DIBUAT IDENTIK DENGAN windows.html: Sederhana, tanpa flexbox */
            background-color: rgba(0, 0, 0, 0);
            font-family: 'Nunito', sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 20px;
        }

        #chat-container {
            /* PERBAIKAN: Logika Flexbox dipindahkan ke sini dari body */
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            display: flex;
            flex-direction: column-reverse;
            justify-content: flex-start;
            padding: 20px; /* Padding dipindahkan ke sini */
        }

        .message-wrapper {
            background-color: rgba(45, 55, 72, 0.85);
            border: 1px solid rgba(159, 122, 234, 0.7);
            border-radius: 15px;
            padding: 10px 15px;
            margin-bottom: 12px;
            max-width: 450px;
            opacity: 0;
            animation: fadeInMessage 0.5s ease-out forwards;
        }

        @keyframes fadeInMessage {
          from { opacity: 0; transform: translateY(15px); }
          to { opacity: 1; transform: translateY(0); }
        }

        .author-line {
            line-height: 1.5;
        }

        .author-name {
            font-size: 20px;
            font-weight: 700;
            color: #D6BCFA;
            text-transform: uppercase;
        }

        .comment-content {
            padding: 8px 0;
            margin: 0;
            font-size: 18px;
            line-height: 1.5;
            color: #E2E8F0;
            text-align: center;
            word-wrap: break-word;
        }
        
        .comment-content img {
            height: 1.5em;
            vertical-align: middle;
            margin: -0.2em 0.1em;
        }

        .satellite-gif, .signal-gif {
            height: 22px;
            width: auto;
            vertical-align: middle;
            display: inline-block;
        }
        .satellite-gif {
            margin-left: 8px;
        }
        .signal-gif {
            margin-left: 5px;
        }

        .celestial-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(159, 122, 234, 0.2);
        }

        .celestial-gif {
            height: 30px;
            width: 30px;
        }

        .signal-line {
            flex-grow: 1;
            height: 2px; /* Beri sedikit tinggi */
            background-color: rgba(129, 230, 217, 0.2); /* Warna dasar garis */
            margin: 0 10px;
            position: relative; /* Diperlukan untuk pseudo-element ::after */
            overflow: hidden; /* Sembunyikan gradien yang keluar dari kotak */
        }
        
        /* (BARU) Membuat elemen animasi yang bergerak */
        .signal-line::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(129, 230, 217, 0.9), transparent);
            animation: animate-signal 2.5s linear infinite;
        }

        /* (BARU) Keyframes untuk animasi garis sinyal */
        @keyframes animate-signal {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
    </style>
</head>
<body>

<!-- Wadah utama untuk menampung semua pesan chat -->
<div id="chat-container"></div>

<script>
    // === BAGIAN INTI DARI "WINDOWS.HTML" (YANG TERBUKTI BERFUNGSI) ===

    const urlParams = new URLSearchParams(window.location.search);
    const sessionID = urlParams.get("session"); // Mengambil session ID dari URL
    const password = "false"; // Menambahkan parameter ini agar 100% sama dengan windows.html

    // Jika tidak ada session ID, tampilkan pesan error dan berhenti.
    if (!sessionID) {
        document.body.innerHTML = '<div style="font-family: sans-serif; color: white; background: red; padding: 20px; border-radius: 10px;">ERROR: Session ID tidak ditemukan di URL. Pastikan URL Anda mengandung `?session=ID_ANDA`.</div>';
    } else {
        // PERBAIKAN: Membuat URL iframe 100% identik dengan windows.html
        const iframe = document.createElement("iframe");
        iframe.src = `https://vdo.socialstream.ninja/?ln&salt=vdo.ninja&password=${password}&push&label=dock&vd=0&ad=0&novideo&noaudio&autostart&cleanoutput&room=${sessionID}`;
        iframe.style.cssText = "width: 0px; height: 0px; position: fixed; left: -100px; top: -100px;";
        document.body.appendChild(iframe);

        // Mendengarkan pesan yang masuk dari iframe
        window.addEventListener("message", (event) => {
            if (event.source !== iframe.contentWindow) return;
            if (event.data.dataReceived && event.data.dataReceived.overlayNinja) {
                // Saat data diterima, panggil fungsi kita untuk membuat pesan dengan gaya kustom
                addStyledMessageToOverlay(event.data.dataReceived.overlayNinja);
            }
        });
        console.log("Overlay Hibrida Siap! Menunggu pesan dari Social Stream Ninja...");
    }
    

    // === BAGIAN KUSTOMISASI KITA (FUNGSI BARU) ===

    const chatContainer = document.getElementById('chat-container');

    // --- KONFIGURASI ASET ANDA ---
    const GITHUB_USERNAME = 'flevy04';
    const GITHUB_REPO_NAME = 'ytchat-overlay';
    const BASE_ASSET_URL = `https://${GITHUB_USERNAME}.github.io/${GITHUB_REPO_NAME}/assets/`;

    const signalGifs = [
        `${BASE_ASSET_URL}signal1.gif`,
        `${BASE_ASSET_URL}signal2.gif`,
        `${BASE_ASSET_URL}signal3.gif`
    ];
    const satelliteGifUrl = `${BASE_ASSET_URL}satellite.png`;
    const earthGifUrl = `${BASE_ASSET_URL}earth.gif`;
    const plutoGifUrl = `${BASE_ASSET_URL}pluto.gif`;

    function addStyledMessageToOverlay(data) {
        // Abaikan jika tidak ada pesan chat
        if (!data.chatmessage) {
            return;
        }

        // 1. Buat elemen pembungkus utama
        const messageWrapper = document.createElement('div');
        messageWrapper.className = 'message-wrapper';

        // 2. Buat baris untuk nama dan ikon
        const authorLine = document.createElement('div');
        authorLine.className = 'author-line';

        const authorName = document.createElement('span');
        authorName.className = 'author-name';
        authorName.textContent = data.chatname || 'Anonymous';
        authorLine.appendChild(authorName);

        const satelliteImg = document.createElement('img');
        satelliteImg.className = 'satellite-gif';
        satelliteImg.src = satelliteGifUrl;
        authorLine.appendChild(satelliteImg);

        const signalImg = document.createElement('img');
        signalImg.className = 'signal-gif';
        signalImg.src = signalGifs[Math.floor(Math.random() * signalGifs.length)];
        authorLine.appendChild(signalImg);

        // 3. Buat elemen untuk isi pesan
        const commentContent = document.createElement('div');
        commentContent.className = 'comment-content';
        // Social Stream Ninja sudah mengirim pesan sebagai HTML (dengan emote <img>)
        commentContent.innerHTML = data.chatmessage;

        // 4. Buat footer
        const footer = document.createElement('div');
        footer.className = 'celestial-footer';
        footer.innerHTML = `
            <img class="celestial-gif" src="${earthGifUrl}">
            <div class="signal-line"></div>
            <img class="celestial-gif" src="${plutoGifUrl}">
        `;

        // 5. Gabungkan semuanya
        messageWrapper.appendChild(authorLine);
        messageWrapper.appendChild(commentContent);
        messageWrapper.appendChild(footer);

        // 6. Tambahkan ke halaman dan atur agar tidak melebihi batas
        chatContainer.prepend(messageWrapper);
        while (chatContainer.children.length > 20) { // Batasi 20 pesan
            chatContainer.removeChild(chatContainer.lastChild);
        }
    }
</script>
</body>
</html>
